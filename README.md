## Test Enviroment
* M2 Pro MacOS 14.3
* Python 3.9.18 with Anaconda

Run the following commands:
* `python -m pip install --upgrade pip`
* `pip install -U scikit-learn`
* No need to install `mlrose`, skipped from requirements.txt

# CoMTE
Counterfactual Explanations for Multivariate Time Series Data

CoMTE is a novel counterfactual
multivariate time series explainability method that provides explanations for
individual predictions. The counterfactual explanations consist of hypothetical
samples that are as similar as possible to the sample that is explained, while
having a different classification label; i.e., "if the values of these
particular time series were different in the given sample, the classification
label would have been different." 

Counterfactual explanations are generated by selecting time series from the training set and substituting them in the sample
under investigation to obtain different classification results. In this way, end
users can understand the classification decision by examining a limited number of variables.

Maintainer: 
* **Burak Aksar** - *baksar@bu.edu* 

Developers:  
* **Emre Ates** - *ates@bu.edu*  & **Burak Aksar** - *baksar@bu.edu* 


## Requirements

We provide NATOPS dataset in the repo and you can start using CoMTE without downloading the other data sets.

In case you want to see more examples, we use HPC data sets in our paper and these are located on [Zenodo](https://doi.org/10.5281/zenodo.3760027). After you click download, it will send a request to the owner, and after the approval, you will receive a link to download HPC data sets. 


A python 3.x installation is required, as well as the packages inside
`requirements.txt` and the `fast_features` package. 

```
pip3 install --user -r requirements.txt
```

Instructions for `fast_features` package are inside the fast_features directory.



## Usage

The code assumes that the data is located at ./data

```python
import explainers
comte = explainers.OptimizedSearch(pipeline, timeseries, labels, silent=False, threads=1)

#Call explain method with a sample from timeseries
comte.explain(test_timeseries.loc[['5c15428439747d4a8fa8f85d_60'], :, :], to_maximize=5, savefig=False)
```

* pipeline: A blackbox ML model that can return prediction probabilities
* timeseries: Data
* labels: Labels


## Known Issues
* On M1 Macbooks, the error `AttributeError: 'NoneType' object has no attribute 'copy'` 
  might be raised in explainers.py. Setting `threads=1` in the constructor for 
  `explainers.OptimizedSearch` has been reported to fix the issue.


## Authors

ICAPAI'21: [Counterfactual Explanations for
Multivariate Time Series](https://www.bu.edu/peaclab/files/2021/05/CoMTE___ICAPAI.pdf)


ArXiv: [Counterfactual Explanations for Machine Learning
on Multivariate Time Series Data](https://arxiv.org/pdf/2008.10781.pdf)

Authors:
    Emre Ates (1), Burak Aksar (1), Vitus J. Leung (2), Ayse K. Coskun (1)

Affiliations:
    (1) Department of Electrical and Computer Engineering, Boston University
    (2) Sandia National Laboratories

This work has been partially funded by Sandia National Laboratories. Sandia
National Laboratories is a multimission laboratory managed and operated by
National Technology and Engineering Solutions of Sandia, LLC., a wholly owned
subsidiary of Honeywell International, Inc., for the U.S. Department of
Energyâ€™s National Nuclear Security Administration under Contract DENA0003525.

## License

This project is licensed under the BSD 3-Clause License - see the LICENSE file for details



